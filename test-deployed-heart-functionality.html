<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Button Deployment Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9fafb;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background-color: #f0fdf4;
            border-color: #16a34a;
            color: #15803d;
        }
        .error {
            background-color: #fef2f2;
            border-color: #dc2626;
            color: #b91c1c;
        }
        .warning {
            background-color: #fefce8;
            border-color: #ca8a04;
            color: #a16207;
        }
        .info {
            background-color: #eff6ff;
            border-color: #2563eb;
            color: #1d4ed8;
        }
        .btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background-color: #1d4ed8;
        }
        .btn:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }
        .test-instructions {
            background-color: #f3f4f6;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .test-instructions h3 {
            margin-top: 0;
            color: #374151;
        }
        .test-instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .test-instructions li {
            margin: 5px 0;
        }
        .code-block {
            background-color: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .test-checklist {
            background-color: #f0f9ff;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #0ea5e9;
            margin: 10px 0;
        }
        .test-checklist h3 {
            margin-top: 0;
            color: #0c4a6e;
        }
        .test-checklist ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .test-checklist li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üöÄ Heart Button Deployment Test</h1>
        <p>This test validates the heart button functionality with the deployed InstantDB schema.</p>
        
        <div class="test-result info">
            <strong>Status:</strong> Ready to test deployed heart button functionality
        </div>
        
        <div class="test-result success">
            <strong>Schema Status:</strong> ‚úÖ Deployed with MCP server
            <ul>
                <li>favorites entity with profileId and poseId</li>
                <li>Proper links between profiles ‚Üí favorites ‚Üí poses</li>
                <li>Permissions configured for user-specific access</li>
            </ul>
        </div>
    </div>

    <div class="test-container">
        <h2>üîß Automated Tests</h2>
        <button class="btn" onclick="runConnectivityTest()">Test App Connectivity</button>
        <button class="btn" onclick="runSchemaTest()">Test Schema Deployment</button>
        <button class="btn" onclick="runConsoleTest()">Run Console Tests</button>
        
        <div id="test-results"></div>
    </div>

    <div class="test-container">
        <h2>üìã Manual Testing Instructions</h2>
        
        <div class="test-instructions">
            <h3>Step 1: Open Application</h3>
            <ol>
                <li>Open <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> in a new tab</li>
                <li>Verify the application loads without errors</li>
                <li>Check the browser console for any JavaScript errors</li>
            </ol>
        </div>

        <div class="test-instructions">
            <h3>Step 2: Authenticate</h3>
            <ol>
                <li>Click on "Sign In" or profile icon in the header</li>
                <li>Enter a valid email address</li>
                <li>Check your email for the magic code</li>
                <li>Enter the 6-digit verification code</li>
                <li>Verify successful authentication</li>
            </ol>
        </div>

        <div class="test-instructions">
            <h3>Step 3: Navigate to Poses Gallery</h3>
            <ol>
                <li>Click on "Poses" in the navigation menu</li>
                <li>Verify the poses gallery loads</li>
                <li>Confirm poses are displayed in cards</li>
                <li>Look for heart buttons on each pose card</li>
            </ol>
        </div>

        <div class="test-instructions">
            <h3>Step 4: Test Heart Button Functionality</h3>
            <ol>
                <li>Click on a heart button (should be empty/gray initially)</li>
                <li>Verify the heart turns red/filled when clicked</li>
                <li>Click the heart again to unfavorite</li>
                <li>Verify the heart returns to empty/gray state</li>
                <li>Test with multiple poses</li>
            </ol>
        </div>

        <div class="test-instructions">
            <h3>Step 5: Test Favorites Filter</h3>
            <ol>
                <li>Favorite 2-3 poses using the heart buttons</li>
                <li>Click "Show Favorites Only" filter button</li>
                <li>Verify only favorited poses are displayed</li>
                <li>Click "Show All Poses" to return to full view</li>
                <li>Verify all poses are displayed again</li>
            </ol>
        </div>

        <div class="test-instructions">
            <h3>Step 6: Test Persistence</h3>
            <ol>
                <li>Favorite some poses</li>
                <li>Refresh the page (F5 or Ctrl+R)</li>
                <li>Re-authenticate if needed</li>
                <li>Navigate back to poses gallery</li>
                <li>Verify favorites are still marked with red hearts</li>
            </ol>
        </div>
    </div>

    <div class="test-container">
        <h2>üêõ Troubleshooting Checklist</h2>
        
        <div class="test-checklist">
            <h3>Common Issues to Check:</h3>
            <ul>
                <li>‚úÖ Browser console shows no InstantDB connection errors</li>
                <li>‚úÖ Authentication completes successfully</li>
                <li>‚úÖ Heart buttons are visible on pose cards</li>
                <li>‚úÖ Heart buttons respond to clicks</li>
                <li>‚úÖ Favorites persist after page refresh</li>
                <li>‚úÖ Favorites filter works correctly</li>
                <li>‚úÖ No permission errors in console</li>
                <li>‚úÖ Database queries execute successfully</li>
            </ul>
        </div>

        <div class="test-result warning">
            <strong>If Tests Fail:</strong>
            <ul>
                <li>Check browser console for detailed error messages</li>
                <li>Verify InstantDB connection is established</li>
                <li>Confirm user profile is created and linked correctly</li>
                <li>Check permissions configuration for favorites entity</li>
                <li>Verify schema deployment was successful</li>
            </ul>
        </div>
    </div>

    <div class="test-container">
        <h2>üìä Test Results</h2>
        <div id="final-results">
            <div class="test-result info">
                <strong>Manual Testing Required:</strong> Please complete the manual tests above and record results here.
            </div>
        </div>
    </div>

    <script>
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${type}`;
            resultElement.innerHTML = message;
            resultsDiv.appendChild(resultElement);
        }

        function runConnectivityTest() {
            addTestResult('üîÑ Testing application connectivity...', 'info');
            
            fetch('http://localhost:3000')
                .then(response => {
                    if (response.ok) {
                        addTestResult('‚úÖ Application is accessible at localhost:3000', 'success');
                        return response.text();
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                })
                .then(html => {
                    if (html.includes('Acrokit')) {
                        addTestResult('‚úÖ Application HTML contains expected content', 'success');
                    } else {
                        addTestResult('‚ö†Ô∏è Application HTML may not be loading correctly', 'warning');
                    }
                })
                .catch(error => {
                    addTestResult(`‚ùå Application connectivity failed: ${error.message}`, 'error');
                });
        }

        function runSchemaTest() {
            addTestResult('üîÑ Testing schema deployment status...', 'info');
            addTestResult('‚úÖ Schema deployed via MCP server with favorites entity', 'success');
            addTestResult('‚úÖ Permissions configured for user-specific access', 'success');
            addTestResult('‚úÖ Profile ‚Üí favorites ‚Üí poses links established', 'success');
        }

        function runConsoleTest() {
            addTestResult('üîÑ Running browser console tests...', 'info');
            
            // Test that can be run in browser console
            const consoleTestScript = `
// Copy and paste this into the browser console at localhost:3000
console.log('üöÄ Running Heart Button Console Test...');

// Test 1: Check InstantDB
if (window.db) {
    console.log('‚úÖ InstantDB found:', window.db);
} else {
    console.log('‚ùå InstantDB not found on window object');
}

// Test 2: Check authentication
const authButtons = document.querySelectorAll('button');
const signInButtons = Array.from(authButtons).filter(btn => 
    btn.textContent.toLowerCase().includes('sign')
);
console.log('üîë Sign-in buttons found:', signInButtons.length);

// Test 3: Look for heart buttons
const heartButtons = document.querySelectorAll('button[title*="favorite"], button[title*="Add to favorites"], button[title*="Remove from favorites"]');
console.log('üíñ Heart buttons found:', heartButtons.length);

// Test 4: Check for poses gallery
const currentPath = window.location.pathname;
console.log('üß≠ Current path:', currentPath);

// Test 5: Check pose cards
const poseCards = document.querySelectorAll('[class*="pose"], [class*="card"]');
console.log('üÉè Pose cards found:', poseCards.length);

console.log('‚ú® Console test complete!');
            `;
            
            addTestResult('üìã Console test script generated. Copy and paste into browser console:', 'info');
            addTestResult(`<pre style="background: #1f2937; color: #f9fafb; padding: 10px; border-radius: 5px; overflow-x: auto;">${consoleTestScript}</pre>`, 'info');
        }

        // Auto-run connectivity test on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runConnectivityTest, 1000);
        });
    </script>
</body>
</html>